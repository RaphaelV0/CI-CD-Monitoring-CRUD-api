[SERVICE]
    Flush         5
    Daemon        off
    Log_Level     info
    Parsers_File  parsers.conf

# INPUT: Logs applicatifs
[INPUT]
    Name              tail
    Path              /var/logs/crud/app.log
    Tag               crud.app
    Parser            json
    Refresh_Interval  5
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    Read_from_Head    False
    Skip_Empty_Lines  On

# INPUT: Logs Nginx (access.log)
[INPUT]
    Name              tail
    Path              /var/logs/crud/access.log
    Tag               crud.nginx
    Parser            json
    Refresh_Interval  5
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    Read_from_Head    False
    Skip_Empty_Lines  On

# FILTER: App logs - garder message et endpoint
[FILTER]
    Name                record_modifier
    Match               crud.app
    Allowlist_key       message
    Allowlist_key       endpoint
    Allowlist_key       level

# FILTER: Nginx logs - garder status, method, uri
[FILTER]
    Name                record_modifier
    Match               crud.nginx
    Allowlist_key       status
    Allowlist_key       method
    Allowlist_key       uri
    Allowlist_key       response_time

# OUTPUT: Envoyer vers Loki
[OUTPUT]
    Name                loki
    Match               crud.*
    Host                ${LOKI_HOST}
    Port                ${LOKI_PORT}
    Labels              job=${LOKI_JOB_LABEL}
    Line_format         json
    Auto_Kubernetes_Labels off